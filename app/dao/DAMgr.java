/**
 * 
 */
package dao;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import com.amazonaws.auth.BasicAWSCredentials;
import com.amazonaws.services.dynamodbv2.AmazonDynamoDBClient;
import com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBMapper;
import com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBScanExpression;
import com.amazonaws.services.dynamodbv2.model.AttributeValue;
import com.amazonaws.services.dynamodbv2.model.ComparisonOperator;
import com.amazonaws.services.dynamodbv2.model.Condition;

import play.Play;

/**
 * @author tieuluu
 * Data Access Manager
 *
 */
public class DAMgr {
	static SimpleDateFormat dateFormatter = new SimpleDateFormat(
            "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'");
	
	public static final String AWS_ACCESS_KEY = "aws.access.key";
	public static final String AWS_SECRET_KEY = "aws.secret.key";
	
	private static String accessKey;
	private static String secretKey;
	private static AmazonDynamoDBClient dynamoDBClient;
	private static DynamoDBMapper mapper;
	
	static {
		accessKey = Play.application().configuration().getString(AWS_ACCESS_KEY);
        secretKey = Play.application().configuration().getString(AWS_SECRET_KEY);
        dynamoDBClient = new AmazonDynamoDBClient(new BasicAWSCredentials(accessKey, secretKey));
        mapper = new DynamoDBMapper(dynamoDBClient);
	}
	
	public static List<Malware> getMalwareCatalog() {
		DynamoDBScanExpression scanExpr = new DynamoDBScanExpression();
		scanExpr.addFilterCondition("MalwareID", new Condition()
				.withComparisonOperator(ComparisonOperator.NE)
				.withAttributeValueList(new AttributeValue().withS("MalwareNotifyTopic")));
		return mapper.scan(Malware.class, scanExpr);
	}
	
	public static List<MalwareDevice> getMalwareDevices(String malwareID) {
		String now = dateFormatter.format(new Date(System.currentTimeMillis()));
		MalwareDevice dev1 = new MalwareDevice();
		dev1.setDeviceID("123.tieuluu.com");
		dev1.setDateInfected(now);
		MalwareDevice dev2 = new MalwareDevice();
		dev2.setDeviceID("456.tieuluu.com");
		dev2.setDateInfected(now);
		ArrayList<MalwareDevice> list = new ArrayList<MalwareDevice>();
		list.add(dev1);
		list.add(dev2);
		return list;
	}
}
